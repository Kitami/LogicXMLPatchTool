<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Logic XML Patch Tool</title>
</head>
<body>
  <div class="file">
    <label>Logic XML Patch Tool</label><br>
    <input type="file" accept=".xml">
  </div>
  <a id="download" download="output.xml">ダウンロード</a>

  <script>
    const inputFile = document.querySelector('input[type=file]');
    const downloadLink = document.getElementById('download');

    inputFile.addEventListener('change', (event) => {
      const fileObject = event.target.files[0];
      const rwgXml = new FileReader();
      rwgXml.addEventListener('load', () => loadedFile(rwgXml.result));
      rwgXml.readAsText(fileObject);
    });

    const loadedFile = (xmlContent) => {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlContent, 'application/xml');
      xmlDoc.querySelectorAll('midi-program').forEach(element => element.innerHTML = '1');
      xmlDoc.querySelectorAll('instrument-name').forEach(element => element.innerHTML = 'Piano');
      const outputXmlText = new XMLSerializer().serializeToString(xmlDoc);
      const blob = new Blob([outputXmlText], { type: 'application/xml' });
      const originalFileName = inputFile.files[0].name;
      const newFileName = originalFileName.replace(/\.xml$/, '_new.xml');
      downloadLink.download = newFileName;
      downloadLink.href = window.URL.createObjectURL(blob);
      downloadLink.click();
    };
  </script>
</body>
</html>
